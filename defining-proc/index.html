<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Defining a process - pipen</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="//use.fontawesome.com/releases/v5.8.1/css/all.css" rel="stylesheet" />
        <link href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css" rel="stylesheet" />
        <link href="../css/mkapi-common.css" rel="stylesheet" />
        <link href="../assets/style.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Defining a process";
        var mkdocs_page_input_path = "defining-proc.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.configure({ ignoreUnescapedHTML: true }); hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="..">
          <img src="../rtd-logo.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="nav-scrollable-wrapper">
      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Introduction</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutorials</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../tutorials/beginner/">Beginner Tutorial</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Defining a process</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#subclassing-pipenproc">Subclassing pipen.Proc</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-class-method-procfrom_proc">Using class method Proc.from_proc()</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#how-about-instantiation-of-proc-directly">How about instantiation of Proc directly?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#how-about-instantiation-of-a-proc-subclass">How about instantiation of a Proc subclass?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#how-about-copydeep-copy-of-a-proc-subclass">How about copy/deep-copy of a Proc subclass?</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../running/">Defining and running a pipeline</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">How-to Guides</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../templating/">Templating</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../channels/">Channels</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../input-output/">Input and output</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../script/">Script</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../caching/">Caching</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cloud/">Cloud support</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../error/">Error handling</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../configurations/">Configurations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../plugin/">Plugins</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scheduler/">Scheduler</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../proc-group/">Process group</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cli/">Command line interface</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">pipen</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen/">pipen</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen.pluginmgr/">pipen.pluginmgr</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen.utils/">pipen.utils</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen.proc/">pipen.proc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen.version/">pipen.version</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen.job/">pipen.job</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen.scheduler/">pipen.scheduler</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen.exceptions/">pipen.exceptions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen.pipen/">pipen.pipen</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen.channel/">pipen.channel</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen.progressbar/">pipen.progressbar</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen.template/">pipen.template</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen.procgroup/">pipen.procgroup</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen.defaults/">pipen.defaults</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">pipen.cli</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen.cli/">pipen.cli</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen.cli.profile/">pipen.cli.profile</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen.cli.version/">pipen.cli.version</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen.cli.help/">pipen.cli.help</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../api/pipen.cli.plugins/">pipen.cli.plugins</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../examples/">Examples</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CHANGELOG/">Change Log</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING/">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../glossary/">Glossary</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Explanation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../architecture/">Architecture</a>
                  </li>
              </ul>
      </div>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">pipen</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Tutorials</li>
      <li class="breadcrumb-item active">Defining a process</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/pwwang/pipen/blob/master/docs/defining-proc.md">Edit on pwwang/pipen</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p>A pipeline consists of many processes, which could own multiple jobs that run in parallel.</p>
<h3 id="definingcreating-processes">Defining/Creating processes<a class="headerlink" href="#definingcreating-processes" title="Permanent link">&para;</a></h3>
<p><code>pipen</code> has two (preferred) ways to define processes:</p>
<h4 id="subclassing-pipenproc">Subclassing <code>pipen.Proc</code><a class="headerlink" href="#subclassing-pipenproc" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pipen</span><span class="w"> </span><span class="kn">import</span> <span class="n">Proc</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyProcess</span><span class="p">(</span><span class="n">Proc</span><span class="p">):</span>
    <span class="o">...</span> <span class="c1"># process configurations</span>
</code></pre></div>
<p>The configurations are specified as class variables of the class.</p>
<h4 id="using-class-method-procfrom_proc">Using class method <code>Proc.from_proc()</code><a class="headerlink" href="#using-class-method-procfrom_proc" title="Permanent link">&para;</a></h4>
<p>If you want to reuse a defined process, you can either subclass it:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MyOtherProcess</span><span class="p">(</span><span class="n">MyProcess</span><span class="p">):</span>
    <span class="o">...</span> <span class="c1"># configurations inherited from MyProcess</span>
</code></pre></div>
<p>Or use <code>Proc.from_proc()</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># You can also pass the configurations you want to override</span>
<span class="n">MyOtherProcess</span> <span class="o">=</span> <span class="n">Proc</span><span class="o">.</span><span class="n">from_proc</span><span class="p">(</span><span class="n">MyProcess</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div>
<p>Note that <code>Proc.from_proc()</code> cannot override all configurations/class variables, because we assume that there are some shared configurations if you want to "copy" from another process.</p>
<p>These shared configurations are:</p>
<ol>
<li>Template engine and its options (<code>template</code> and <code>template_opts</code>)</li>
<li>Script template (<code>script</code>)</li>
<li>Input keys (<code>input</code>)</li>
<li>Language/Interpreter of the script (<code>lang</code>)</li>
<li>Output keys (<code>output</code>)</li>
</ol>
<p>All other configurations can be passed to <code>Proc.from_proc()</code> to override the old ones.</p>
<p>For all configurations/class variables for a process, see next section.</p>
<p>You don't need to specify the new name of the new process, the variable name on the left-handle side will be used if <code>name</code> argument is not provided to <code>Proc.from_proc()</code>. For example:</p>
<div class="highlight"><pre><span></span><code><span class="n">NewProc</span> <span class="o">=</span> <span class="n">Proc</span><span class="o">.</span><span class="n">from_proc</span><span class="p">(</span><span class="n">OldProc</span><span class="p">)</span>
<span class="c1"># NewProc.name == &quot;NewProc&quot;</span>
</code></pre></div>
<p>But you are able to assign a different name to a new process if you want. For example:</p>
<div class="highlight"><pre><span></span><code><span class="n">NewProc</span> <span class="o">=</span> <span class="n">Proc</span><span class="o">.</span><span class="n">from_proc</span><span class="p">(</span><span class="n">OldProc</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;NewProc2&quot;</span><span class="p">)</span>
<span class="c1"># NewProc.name = &quot;NewProc2&quot;</span>
</code></pre></div>
<h4 id="how-about-instantiation-of-proc-directly">How about instantiation of <code>Proc</code> directly?<a class="headerlink" href="#how-about-instantiation-of-proc-directly" title="Permanent link">&para;</a></h4>
<p>You are not allowed to do that. <code>Proc</code> is an abstract class, which is designed to be subclassed.</p>
<h4 id="how-about-instantiation-of-a-proc-subclass">How about instantiation of a <code>Proc</code> subclass?<a class="headerlink" href="#how-about-instantiation-of-a-proc-subclass" title="Permanent link">&para;</a></h4>
<p>Nope, in <code>pipen</code>, a process is a <code>Proc</code> subclass itself. The instances of the subcleasses are used internally, and they are singletons. In most cases, you don't need to use the instances, unless you want to access the computed properties of the instances, including:</p>
<ul>
<li><code>pipeline</code>: The pipeline, which is a <code>Pipen</code> object</li>
<li><code>pbar</code>: The progress bar for the process, indicating the job status of this process</li>
<li><code>jobs</code>: The jobs of this process</li>
<li><code>xqute</code>: The <code>Xqute</code> object to manage the job running.</li>
<li><code>template</code>: The template engine (a <code>pipen.template.Template</code> object)</li>
<li><code>template_opts</code>: The template options (overwritten from config by the <code>template_opts</code> class variable)</li>
<li><code>input</code>: The sanitized input keys and types</li>
<li><code>output</code>: The compiled output template, ready for the jobs to render with their own data</li>
<li><code>scheduler</code>: The scheduler object (inferred from the name or sheduler object from the <code>scheduler</code> class variable)</li>
<li><code>script</code>: The compiled script template, ready for the jobs to render with their own data</li>
</ul>
<h4 id="how-about-copydeep-copy-of-a-proc-subclass">How about copy/deep-copy of a <code>Proc</code> subclass?<a class="headerlink" href="#how-about-copydeep-copy-of-a-proc-subclass" title="Permanent link">&para;</a></h4>
<p>Nope. Copy or deep-copy of a <code>Proc</code> subclass won't trigger <code>__init_subclass__()</code>, where consolidate the process name from the class name if not specified and connect the required processes with the current one. Copy or deep-copy keeps all properties, but disconnect the relationships between current process and the dependency processes, even with a separate assignment, such as <code>MyProcess.requires = ...</code>.</p>
<h3 id="process-configurations-and-proc-class-variables">process configurations and <code>Proc</code> class variables<a class="headerlink" href="#process-configurations-and-proc-class-variables" title="Permanent link">&para;</a></h3>
<p>The configurations of a process are specified as class variables of subclasses of <code>Proc</code>.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Meaning</th>
<th>Can be overwritten by <code>Proc.from_proc()</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>The name of the process. Will use the class name by default.</td>
<td>Yes</td>
</tr>
<tr>
<td><code>desc</code></td>
<td>The description of the process. Will use the summary from the docstring by default.</td>
<td>Yes</td>
</tr>
<tr>
<td><code>envs</code></td>
<td>The env variables that are job-independent, useful for common options across jobs.</td>
<td>Yes, and old ones will be inherited</td>
</tr>
<tr>
<td><code>cache</code></td>
<td>Should we detect whether the jobs are cached?</td>
<td>Yes</td>
</tr>
<tr>
<td><code>dirsig</code></td>
<td>When checking the signature for caching, the depth we should walk through the content of the directory? This is sometimes time-consuming if the directory and the depth are big.</td>
<td>Yes</td>
</tr>
<tr>
<td><code>export</code></td>
<td>When True, the results will be exported to <code>&lt;pipeline.outdir&gt;</code> Defaults to None, meaning only end processes will export. You can set it to True/False to enable or disable exporting for processes</td>
<td>Yes</td>
</tr>
<tr>
<td><code>error_strategy</code></td>
<td>How to deal with the errors: retry, ignore, halt</td>
<td>Yes</td>
</tr>
<tr>
<td><code>num_retries</code></td>
<td>How many times to retry to jobs once error occurs</td>
<td>Yes</td>
</tr>
<tr>
<td><code>template</code></td>
<td>Define the template engine to use.</td>
<td>No</td>
</tr>
<tr>
<td><code>template_opts</code></td>
<td>Options to initialize the template engine.</td>
<td>No</td>
</tr>
<tr>
<td><code>forks</code></td>
<td>How many jobs to run simultaneously?</td>
<td>Yes</td>
</tr>
<tr>
<td><code>input</code></td>
<td>The keys and types for the input channel</td>
<td>No</td>
</tr>
<tr>
<td><code>input_data</code></td>
<td>The input data (will be computed for dependent processes)</td>
<td>Yes</td>
</tr>
<tr>
<td><code>lang</code></td>
<td>The language for the script to run.</td>
<td>No</td>
</tr>
<tr>
<td><code>order</code></td>
<td>The execution order for the same dependency-level processes</td>
<td>Yes</td>
</tr>
<tr>
<td><code>output</code></td>
<td>The output keys for the output channel</td>
<td>No</td>
</tr>
<tr>
<td><code>plugin_opts</code></td>
<td>Options for process-level plugins</td>
<td>Yes</td>
</tr>
<tr>
<td><code>requires</code></td>
<td>The dependency processes</td>
<td>Yes</td>
</tr>
<tr>
<td><code>scheduler</code></td>
<td>The scheduler to run the jobs</td>
<td>Yes</td>
</tr>
<tr>
<td><code>scheduler_opts</code></td>
<td>The options for the scheduler</td>
<td>Yes</td>
</tr>
<tr>
<td><code>script</code></td>
<td>The script template for the process</td>
<td>No</td>
</tr>
<tr>
<td><code>submission_batch</code></td>
<td>How many jobs to be submited simultaneously</td>
<td>Yes</td>
</tr>
</tbody>
</table>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../tutorials/beginner/" class="btn btn-neutral float-left" title="Beginner Tutorial"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../running/" class="btn btn-neutral float-right" title="Defining and running a pipeline">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  <div class="footer-notes">
    <a href="https://github.com/pwwang/pipen" title="Open repository in GitHub">Github Repo</a>
    <div class="footer-sep"></div>Built with <a href="https://www.mkdocs.org/">MkDocs</a> using theme <a href="https://github.com/pwwang/mkdocs-rtd">mkdocs-rtd</a>.
  </div>
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../tutorials/beginner/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../running/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
    <script src="../js/version-select.js"></script>
      <script src="../js/mkapi.js"></script>
      <script src="../assets/script.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
